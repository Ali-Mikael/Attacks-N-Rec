# H1 sniff
<https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/>   

### X) - Read & Summarize
**Wireshark**
- The leading network sniffer and analyzer.
- Installing wireshark on linux is easy: `$ sudo apt update && sudo apt install wireshark -y`.
- Configure wireshark to allow non-superusers to capture packets.
- Add your user to the wireshark group.
- Now you can run it with the `wireshark` command.
- When you want to sniff traffic you specify an interface to listen to or choose "any".
- If you want to save what you have captured, you can do just that by saving it to a `*.pcap` file.   
<https://terokarvinen.com/wireshark-getting-started/>   

**Network Interface Names on Linux**
- A network interface: in most cases a *physical* or *virtual(software based)* **NIC**.
- The loopback interface used by localhost is a good example of a software based NIC.
- Linux network interfaces are named by systemd.
- The name usually contains the interface type prefix.
- Check your own interfaces with commands
```bash
$ ip a
$ ip route
```    
<https://terokarvinen.com/network-interface-linux/>   


### A) - Linux
Kali already installed we are good to go!    

### B) - Can't fish
*"Prove you can cut your VMs internet connection and plug it back on"*
**Connection is working:**     
<img width="562" height="211" alt="Screenshot 2025-10-25 at 17 05 10" src="https://github.com/user-attachments/assets/1cfef5a1-6b09-43ed-852b-5681b148deee" />      

**Cut the connection by disconnecting the network adapter:**    
<img width="680" height="175" alt="Screenshot 2025-10-25 at 17 06 45" src="https://github.com/user-attachments/assets/479e8e7f-0072-454d-9618-1191544413e5" />
<img width="682" height="174" alt="Screenshot 2025-10-25 at 17 07 09" src="https://github.com/user-attachments/assets/98709d00-8a21-4c6e-9fe9-00e7e6b18773" />     

**Now we don't have a connection anymore:**    
<img width="591" height="127" alt="Screenshot 2025-10-25 at 17 07 47" src="https://github.com/user-attachments/assets/9c1e5f7e-d35f-42a3-884d-1098d00fe5c6" />     

**Want the connection back?**    
Just choose the network adapter:    
<img width="709" height="384" alt="Screenshot 2025-10-25 at 17 17 02" src="https://github.com/user-attachments/assets/8eae0d9b-7f2c-46dc-ac6b-609936e0ed45" />     
If your host machine is connected to the Wi-Fi choose: `En0: Wi-Fi`     
If your host machine is connected through an Ethernet cable choose: `En3: Ethernet adapter`    
Then save your settings and Voila, you have a connection once more!    


### C) - Wireshark
Kali linux comes with wireshark preinstalled, so capturing traffic is easy:   
<img width="1038" height="102" alt="Screenshot 2025-10-25 at 17 29 36" src="https://github.com/user-attachments/assets/7d41f98e-bd5a-4cfc-b560-3c7f7277578f" />    
<img width="1033" height="567" alt="Screenshot 2025-10-25 at 17 30 21" src="https://github.com/user-attachments/assets/f0ef3f26-8f17-4789-8d7a-27f8a60ae86a" />    
From the traffic flow we can see stuff like:
- We have made a DNS query to get the address of a certain website.
- A web server is sending us TPC Acknowledgement packet `[ACK]`
- etc..


### D) - TCP/IP
"Refer to the TCP/IP stack and annotate a packet of your choosing"    
**Packet I chose (at random):**    
<img width="763" height="456" alt="Screenshot 2025-10-25 at 17 38 05" src="https://github.com/user-attachments/assets/eb86a9c1-5aed-49ee-9106-00d694f7b157" />     
##### Lets dig in!
First we have to recall the TCP/IP stack. It consists of 4 layers
- Network access/Link layer
- Internet layer
- Transport layer
- Application layer     

**Examine the frame:**
- At the top level we notice a frame summary
  - Stuff like bytes, interface etc..
- **The 1st layer (Link) we can examine in the Ethernet II section**
  - <img width="737" height="75" alt="Screenshot 2025-10-25 at 17 51 07" src="https://github.com/user-attachments/assets/d01ffe91-d6b6-45b9-ae02-0366535c472f" />
  - Contains link level information like source and destination MAC.
- **The 2nd layer (Network) we can examine in the Internet Protocol section**
  - <img width="738" height="150" alt="Screenshot 2025-10-25 at 17 54 50" src="https://github.com/user-attachments/assets/ae93515d-2b5a-4944-9440-5aced28138fc" />
  - This contains global source and destination information (internet level).
  - `Internet Protocol Version 6`, tells us IPv6 is in use.
- **The 3rd layer (Transport) we can examine in the TCP section**
  - <img width="732" height="345" alt="Screenshot 2025-10-25 at 17 58 17" src="https://github.com/user-attachments/assets/369928f9-28b4-4c04-9bc0-97d638ce7c8f" />
  - This gives us the most insight into the packet itself.
  - Destination port 443 indicates that this is part of a secure HTTPS session.
  - TCP `Flags` section indicates that this is a `TCP Acknowledgement` packet, and as the source is our own address, we can deduce that we are acknowledging received data from a server.
  - From the `[Next Sequence Number: 3812 (relative sequence number)]` section we can determine that bytes up to the 3811th sequence are sent (from the server), and next in line would be 3812.
  - The `Acknowledgement number: 279084` means we are indicating (acknowledging) to the origin server that we have succesfully received *279083 bytes* of data.
- **The 4th layer (Application)**
  - Since this frame is only an acknowledgement to a server of received data, it doesn't contain any application payload, so we don't have any L4 information to go off.
  - Normally this could contain stuff like HTTP response/request etc..








