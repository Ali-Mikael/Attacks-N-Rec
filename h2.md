# H2 Purple rain     

## X) Read and summarize    
**x.1 The Pyramid of Pain**
> <https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html>
- A pyramid illustrating indicators used to detect an adversary's actions.
- The "pain level" indicates how much pain you will cause the adversary when denying it those indicators.
- <img width="410" height="260" alt="Screenshot 2025-10-30 at 11 43 22" src="https://github.com/user-attachments/assets/01ef0960-b35c-44a9-88c1-808e41e2c804" />      

<br> 

**x.2 The Diamond Model of Intrusion Analysis**
> <https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf>
- The *diamond model* is a framework for intrusion analysis, consisting of 4 **core features** used to describe an **event**, which can further be identified as malicious activity. 
- Idea is to deepen the understanding of intrusions to better analyze them.
- <img width="697" height="520" alt="Screenshot 2025-10-30 at 11 42 42" src="https://github.com/user-attachments/assets/b46581b6-5022-4711-afb0-a8c31139ff0f" />


## A) Apache Log
Downloading Apache can be done w:
```
$ sudo apt install apache2
```
Start apache and check that it's running:
```
$ sudo systemctl start apache2
$ systemctl status apache2
```
- <img width="390" height="73" alt="Screenshot 2025-10-30 at 15 28 00" src="https://github.com/user-attachments/assets/a114fd39-8646-4726-add1-3fd0735c9854" />     
- <img width="1055" height="650" alt="Screenshot 2025-10-30 at 15 22 58" src="https://github.com/user-attachments/assets/66a9b891-adfa-4d57-ad68-1e9f90d4023a" />       

Checking the access logs
```
$ cat /var/log/apache2/access.log
```
- <img width="1032" height="192" alt="Screenshot 2025-10-30 at 15 39 40" src="https://github.com/user-attachments/assets/46d80158-3e40-4c8d-83f4-9cbfe9c63c3b" />
- We can see stuff like
  - Who made the request.
  - When the request was made.
  - Type of request.
  - Status code.
  - Size of response.
  - User agent.
**Let's take the first line into consideration**
- Client (us): `127.0.0.1` indicating localhost.
- Request was made on the last thursday of october 2025.
- The `GET / HTTP/1.1` line tells us: Client used the `Get` method for the root document using `HTTP version 1.1`.
- The number after that is the `http status code`. `200` indicating = `OK` (request succeeded).
- Yet another number after the status code tells us the size of the response = `3383 bytes`.
- The hyphen is the `referer` (which is nonexistent on the first line because the request came in directly).
  - An example of the referer can be noted in the second log entry: `"http://localhost/"`
  -  **Q:** What is a referer?
  -  **A:** It indicates to us the **previous website**, which is *linked* to the current website/resource being requested.
- The last piece of information tells us the user agent. Browser & OS details of the client etc..     
<br> 
Sources used:
> <https://www.sumologic.com/blog/apache-access-log> <br> 
> <https://www.geeksforgeeks.org/techtips/http-headers-referer/> <br>      



## B) Nmapped

<img width="924" height="324" alt="Screenshot 2025-11-02 at 13 56 13" src="https://github.com/user-attachments/assets/4cf3af6d-99bf-4535-a64a-70f196ba51cd" /> <br> 
The results:
- By using Nmapped with he `-A` flag, it runs multiple advanced detection features at once.
- The host we scanned is up (reachable)
- Port 80 is open (active)
  - We can even see the title and header of the HTTTP site it serving from the port
- Additionally we can the se hosts operating system and some details regarding it
- From `Network Distance: 0 hop` we can determine that the host we are scanning is on the same network as us. (duhhh it's localhost ðŸ˜‚) But it's a good metric to look out for!
  - **Note:** The same network, might also just be the same *logical network*, se we cannot assume that the host is physically close to us based on this (it's just part of the same broadcast/routing domain).
  - **Also:** Sometimes even though the host is on the same network, we might get `> 0` results. This depends on how the network is set up (and is *outside the scope of these notes*).     


## C) Scripts
From the output in the previous section, we can see that two scripts were automatically ran: `http-title` && `http-server-header`.
More on this topic: <https://nmap.org/book/nse-usage.html>        

## D) The trail
**"Search for trails of the nmap port scan in the logs"**
- <img width="1038" height="533" alt="Screenshot 2025-11-02 at 15 12 38" src="https://github.com/user-attachments/assets/1c9cac36-942a-42f3-9f94-a11a170c364d" />
I couldn't find anything with the command `$ cat /var/log/apache2/access.log`, so I had to navigate to the directory first.        
And wouldnt you know, there was another version of the file. So I then searched through the file using:
```
$ grep -in 'nmap' ./access.log.1
```
**Explanation:**
- The flag `-i` does a case insensitive search
- The `-n` flag gives us the line numbers.
- (if you need more options, checkout `grep man pages`!)

**Analysing:**
- The logs are indicating to us that an *Nmap port scan* was in fact performed.
- Can be determined mostly from the *user agent section* giving more info on the requester.         
- One thing that is standing out to me are the weird ass **http methods** used.
  - Especially the line: `"GET /nmaplowercheck1762084392 ...."`
- Answer to Tero's question = how could you gain the same insight from a much larger log file somewhere else?:
  - Because I used the `-n` flag in my grep search, I can quickly tell we have 30 lines of nmap activity in our access logs.
  - If you wanted to search another file with thousands and thousands of log entries, I guess you could use the same parameters as I used `-i 'nmap'`, as it outputs only entries including `nmap` (case insensitive).         


## E) Wire sharking
Capturing packets while a portscan is performed







