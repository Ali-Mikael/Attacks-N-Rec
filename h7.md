# H7 Wave after wave

# X) Read/watch and summarize

**x.1 - Universal Radio Hacker SDR Tutorial on 433 MHz radio plugs (video)**    
> Published 18.1.2019     
> URL: <https://www.youtube.com/watch?v=sbqMqb6FVMY&t=199s>. Accessed 2/12/2025     
> 3:19 - 7:40    
- `Spectrum analyzer` catches the radio wave -> with the help of the analyzer, one can choose the correct frequency to use.
  - Apparently you have to choose the frequency with a small offset.
- This new frequency in mind, one can take a radio signal sample. (a few seconds is enough)
- From the sample, one is able to see the transmitted bits.
- Things to look out for:
  - Modulation and bit length.     

**x.2 - Decode 433.92 MHz weather station data**
> Published 04/012022, updated: 27/01/2024     
> URL: <https://www.onetransistor.eu/2022/01/decode-433mhz-ask-signal.html>. Accessed 2/12/2025     
- Recording broadcast on the 433 frequency
  - Launch URH, go to Spectrum Analyzer.
  - Choose SDR (Software Defined Radio), set receiving frequency and gain, then wait for signal
  - No signal? Increase gain.
- Then, create a new project & set frequency according to Spectrum Analyzer with a slight offset (20-100KHz).
- => Record a small sample (at least two bursts).
- Save the recordings you like.
- Create a new signal from a single transmission.
- Identify the modulation from the signal clip.
- Then, you can start decoding.    


# A) WebSDR
> "Use a remote WebSDR radio, and listen to the traffic"     
> "Tell the frequency, wavelength and modulation you found. Describe the steps and take a screenshot"     

I found a SDR on <https://eshail.batc.org.uk/nb/>     
- <img width="1210" height="851" alt="Screenshot from 2025-12-02 22-22-00" src="https://github.com/user-attachments/assets/90112527-a288-404f-a9fd-d110040a707d" />
- I really just zoomed out the waterfall, went to a frequency that seemed to have some action, and just tweaked the settings until it clicked.
- I played around with the filter and modulators until I started hearing a voice. It sounded like russian, so I have no idea what was said.
- This was the one:
  - <img width="1024" height="509" alt="Screenshot from 2025-12-02 22-50-16" src="https://github.com/user-attachments/assets/eda755e3-90b2-4aa9-ae58-8a232a4b2100" />
- **Frequency:** 10489689.7kHz / 10,49MHZ
- **Wavelength:** ~28,6m (*Velocity* divided by *frequency*)
- **Modulator:** USB (Upper Sideband)     


# B) rtl_433
I installed the package rtl_433 on my kali-linux VM by using the command:
```bash
$ sudo apt-get install rtl-433
```
Package can be run:
<img width="660" height="103" alt="Screenshot from 2025-12-04 17-12-32" src="https://github.com/user-attachments/assets/5094bc07-13be-4a36-8116-a388ba0d00d7" />     


# C) Analysis
> We are downloading and analysing a sample: <https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/samples/Converted_433.92M_2000k.cs8>     

By using the `-r` flag for rtl_433, we're able to read from file:
- <img width="1025" height="668" alt="Screenshot from 2025-12-04 17-40-40" src="https://github.com/user-attachments/assets/8783ed59-4f91-4467-abcf-6f5531bfc275" />
- <img width="1025" height="642" alt="Screenshot from 2025-12-04 17-51-21" src="https://github.com/user-attachments/assets/c8971fb9-e7fa-4e13-bd0b-0b3c85b19c95" />     


### What's going on?
- We can find a recurring ID in the sample => `8785315`
  - In a two places it's named `House Code`
  - And in those places we either find `Model = Nexa-Security` or `Model = Proove-Security`
  - I guess we can deduce from the sample, that we are working with some sort of home appliances, that belong to the same area/site/room/house/unit etc..

The sample starts with an entry from `KlikAanKlikUit-Switch` and includes the section => `Command : Off`.      
This insinuates that a command is being given, which in this case is "off".     
Immediately afterwards we get two outputs:
- `Proove-Security` && `Nexa-Security` are each returning with a `State : OFF` section, both having their `House Code` match the ID with the Switch.
- I think the Switch is sending an off signal, and the appliances are returning that their state is in fact off. So in total 3 entries for this one operation.
- This happens 4 times over in the sample (4 click operations if you will ðŸ˜†).

- By doing a search online, we can find a few possibilites for what we could be working with. Here are just 2 examples:
- <https://prooveglobal.com/>
  - <img width="1333" height="763" alt="Screenshot from 2025-12-04 18-47-19" src="https://github.com/user-attachments/assets/2635a055-cc83-4932-8842-b6776a8f2063" />
- <https://www.nexasecurity.nl/>
  - <img width="719" height="232" alt="Screenshot from 2025-12-04 18-01-32" src="https://github.com/user-attachments/assets/8272ad43-8ebe-4703-ba4b-32b6257dfcf4" />     


# D) Too complex?
> Sample: <https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/samples/Recorded-HackRF-20250411_183354-433_92MHz-2MSps-2MHz.complex16s>     

We have a sample taken with `URH` (Universal Radio Hacker) in the format `complex16s`, and we want to be able to read it using `rtl_433`.      
I actually searched online for conversion tools etc. until I stumbled upon a very helpful tip from our teacher Tero Karvinen.      
For the conversion, you simple change the name of the file to include the `cs8` suffix, which `rtl_433` then can read.     
**Note:** The filename also needs to include *center frequency* and *sample rate*, using a simple underscore as the delimeter.     
So I changed the file name from `Recorded-HackRF-20250411_183354-433_92MHz-2MSps-2MHz.complex16s` to `urhConverted_433.92M_2000k.cs8`.      
`_433.92M_2000k.cs8` being the crucial part.     
The command then becomes very simple:
```bash
$ mv Recorded-HackRF-20250411_183354-433_92MHz-2MSps-2MHz.complex16s urhSampleConverted_433.92M_2000k.cs8
```
Now we're able to read the sample using `rtl_433`:
- <img width="1062" height="579" alt="Screenshot from 2025-12-04 22-25-47" src="https://github.com/user-attachments/assets/bf34a89f-0e84-4702-bb11-6aa0f572ab5c" />
- We can very quickly notice, that it is the same sample provided to us earlier.
- The switch sending the off command, and the appliances replying.
- For an analysis, look at the previous section!     

More on the formats here:
- <https://github.com/merbanan/rtl_433/blob/ac1e4a8c5a36fb90e3b06c0f01cef00bb3b2614d/docs/IQ_FORMATS.md#file-name-meta-data>       


# E) Ultimate Radio Hacker
> Install urh, Universal Radio Hacker.     

I tried to install it with the command provided in the tips section:
```bash
$ pipx install urh
```
But it kept failing. Error logs said that I need to install `cython`, which I did, and still didn't work.
- <img width="541" height="337" alt="Screenshot from 2025-12-05 11-22-52" src="https://github.com/user-attachments/assets/1410c970-e061-4298-a9fa-6be0c92868c4" />

I thought it had something do with me using `pipx`, which apparently does the whole virtual environment isolation automatically for you, so I thought I'd try creating it myself (the virtual environment), following the same kind of workflow Tero showed us in class.      
Create folder for the env, and move into it:
```bash
$ mkdir urh && cd urh
```

Create virtual environment:
```
$ virtualenv env
```
<img width="1108" height="273" alt="Screenshot from 2025-12-05 10-56-12" src="https://github.com/user-attachments/assets/026f969e-60c9-4f61-bd81-4cf0942fd92a" />

Use it with the command:
```
$ source env/bin/activate
```
<img width="480" height="168" alt="Screenshot from 2025-12-05 11-04-29" src="https://github.com/user-attachments/assets/6b62d448-eb72-40fa-951b-7d4f4d0db0b5" />


An `env` prompt will appear to indicate that you are using that virtual environment. If you wish to stop using it, simply give the command
```bash
$ deactivate
```

I then installed cython using:
```bash
$ pip install cython
```

And then urh using:
```bash
$ pip install urh
```

BUT:
- <img width="1047" height="663" alt="Screenshot from 2025-12-05 11-31-50" src="https://github.com/user-attachments/assets/c85ac53e-67ac-4777-a6f4-f4f9c27f0089" />
- We need cython, but cython is already installed?     


### Moving on to option 2
> Installing from source: <https://github.com/jopohl/urh>     
> <https://www.offensive-wireless.com/how-to-install-universal-radio-hacker/> Section: "Install URH Method 3 â€“ From Source"     


#### Create new env, install cython and clone repo
```bash
$ mkdir urh2 && cd urh2
$ virtualenv --system-site-packages env
$ source env/bin/activate
$ pip install cython
$ git clone --depth=1 https://github.com/jopohl/urh/
```

#### Build
```
$ cd urh
$ python setup.py install
```
<img width="1105" height="530" alt="Screenshot from 2025-12-06 13-39-29" src="https://github.com/user-attachments/assets/447e8cf1-30c5-4117-af96-690424c9d794" />     
<img width="579" height="214" alt="Screenshot from 2025-12-06 13-39-59" src="https://github.com/user-attachments/assets/39833c8c-c09d-4365-ac26-5516934435d5" />      

Start Universal Radio Hacker:
```bash
$ urh
```

<img width="388" height="58" alt="Screenshot from 2025-12-06 13-41-07" src="https://github.com/user-attachments/assets/4b46b640-a7d8-4f3f-8a8b-d7c36ba789b8" />     
<img width="1277" height="744" alt="Screenshot from 2025-12-06 13-40-34" src="https://github.com/user-attachments/assets/3754e0d1-2e76-4d98-96a5-abe3b60095aa" />      

**More on virtual environments:**
- <https://virtualenv.pypa.io/en/latest/>
- <https://www.youtube.com/watch?v=N5vscPTWKOk>
- <https://youtu.be/Y21OR1OPC9A?si=3zyLwK79vxZwXdMr>
- Virtualenv man pages are also very helpful!     

**Sources:**
- <https://www.offensive-wireless.com/how-to-install-universal-radio-hacker/>
- <https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/>
- <https://github.com/jopohl/urh>     


# F-G) Inspect the sample:
<https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/samples/1-on-on-on-HackRF-20250412_113805-433_912MHz-2MSps-2MHz.complex16s>

### "The *Nexa outlet remotecontrol* light switch ON button has been pressed 3 times."
> Investigate using URH


# F) Overview
> Describe the sample in general:     
> Duration?     
> Which frequency?    
> When was the sample taken?    

Download sample:
```bash
$ wget https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/samples/1-on-on-on-HackRF-20250412_113805-433_912MHz-2MSps-2MHz.complex16s
```

Start urh and open the file from the file menu:
- <img width="1244" height="429" alt="Screenshot from 2025-12-06 14-01-00" src="https://github.com/user-attachments/assets/5021ae9e-5a48-4a74-b71a-c48474c3e93e" />
- <img width="1276" height="508" alt="Screenshot from 2025-12-06 14-02-12" src="https://github.com/user-attachments/assets/764a1a16-6128-4ace-b1b0-2696e5cf8f52" />     

**Sample length** =  **5,49 seconds**     
- We get the info by selecting the the whole sample (Ctrl + a) inside the raw signal viewer.
- <img width="1276" height="508" alt="Screenshot from 2025-12-06 14-12-24" src="https://github.com/user-attachments/assets/e6a35562-42d9-4140-9240-b8940893c0c5" />     

**Frequency** = **433.912MHz**             
**Sample taken** = **12.04.2025 at 11:38**    
(This info can be captured straight from the sample file name.)      

By looking at the sample, we can confirm, that we have in fact 3 distinct signals.     

# G) Bits
> Demodulate the signal, so that you get raw bits.     
> What's the right modulation?     
> How long is one raw bit in time?     
> Describe this time by comparing it to something.     
> (Many signals have line encoding, so for the final bits, these "raw bits" still need to be processed.)       

In order to demodulate the signal, we simply change the `Signal view` from *analog* -> to *Demodulated*
- <img width="257" height="117" alt="Screenshot from 2025-12-06 14-45-15" src="https://github.com/user-attachments/assets/cb48493c-0b1d-4658-8e5c-28b79317d23b" />
- <img width="1248" height="391" alt="Screenshot from 2025-12-06 14-46-45" src="https://github.com/user-attachments/assets/dc6b7fe0-c5ee-41bf-8795-163ae758ca04" />


If we zoom in on the sample, we can actually inspect the **raw bits**
- <img width="1248" height="391" alt="Screenshot from 2025-12-06 14-48-15" src="https://github.com/user-attachments/assets/6a143a81-43b9-4220-95ad-2e828d94bf7d" />
- The purple section represents 1s
- The green section represents 0s

**What if the change the modulation?**      
> We also have to fiddle the center a little bit to get sense of 1s and 0s     
> The center: the line between 1 and 0     

#### FSK:
- <img width="1248" height="391" alt="Screenshot from 2025-12-06 14-57-53" src="https://github.com/user-attachments/assets/7020d9e6-9ca7-42b0-8af0-0e2d670eb21e" />     

#### PSK:
- <img width="1248" height="391" alt="Screenshot from 2025-12-06 15-07-02" src="https://github.com/user-attachments/assets/93c06ecf-7e37-48ce-9cca-761a63f8c247" />     

#### ASK:
- <img width="1248" height="391" alt="Screenshot from 2025-12-06 15-08-48" src="https://github.com/user-attachments/assets/76f516dc-96e3-4b2a-9e28-daeac175c158" />     


Atleast to my untrained eye, the `ASK` seems to be the right modulation in this scenario.     
The bits look clean and consistent.     

### A raw bit in time (sounds poetic innit xd)
We zoom in on a bit, and mark it as closely as possible from beginning to end, and get a value: **533Âµs**    
(Âµs = microseconds)     
<img width="1248" height="391" alt="Screenshot from 2025-12-06 15-13-59" src="https://github.com/user-attachments/assets/97b42116-0fd3-4b1a-beb1-fc48b0ef430d" />     

#### Comparison
> One microsecond equals =  0.000001 seconds (6 leading 0s)        

A microsecond compared to a second, is the same as 1 second compared to 11,6 days.      
A microsecond is about **one million times faster** than the *blink of an eye*.     
Borrowed from: <https://www.computerhope.com/jargon/m/microsec.htm>     
     
**Koenigsegg Jesko Absolut**    
Is considered to be the fastest car in the world (at the time of writing this).    
It accelerates from 0-100 in 2.3 seconds (source: <https://www.automobile-catalog.com/performance/2024/2970155/koenigsegg_jesko_absolut.html>)      
2.3s = 2,300,000 Âµs   
0.000533s = 533 Âµs     
That means, that the bit we measured, could've been sent **4 315.2 times**, as the worlds fastest car accelerated to 100km/h.



Very helpful reading and a video on using URH:
- <https://www.oldergeeks.com/downloads/files/userguide.pdf>
- <https://www.youtube.com/watch?v=QqVvEOzKPCs>
